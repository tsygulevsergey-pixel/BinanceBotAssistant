1. начало дня 00:00 UTC
Обновлять зоны на каждом закрытии 4H (00/04/08/12/16/20)
2.  Коротко: делай “липкий” (sticky) якорь.
Т.е. ставим AVWAP на последний валидный свинг (1H/4H) и держим его, пока не появится новый подтверждённый импульс или пока текущий якорь не потеряет силу по формальным правилам.
Где искать якорь

Для сделок на 15m: первичный якорь — 1H, вторичный — 4H.

Для сделок на 1H: первичный якорь — 4H, вторичный — 1D (если хочешь, можешь держать ещё дневной обычный VWAP как контекст).

Как обнаружить “последний значимый свинг”

Свинг — фрактальный pivot:

1H: fractal k=3 (high/low, вокруг ещё по 3 бара с более низкими/высокими экстремумами).

4H: fractal k=2 (достаточно грубо и устойчиво).

Для свинга считаем импульс: ход от pivota в сторону выхода в ближайшие L баров (L=12 для 1H, L=10 для 4H).

Свинг значимый, если impulse >= 1.5 × mTR(TF) (как ты и хотел).

mTR(TF) — твой “median true range” за 20 баров на данном ТФ.
Когда ставить/переставлять якорь (sticky-логика)

Поставить/обновить якорь только при выполнении любой из условий:

1)Новый валидный свинг (из п.2) + подтверждение импульса:

минимум одно из:

2 последовательных закрытия в сторону выхода за пределами 0.25×mTR(TF) от pivota,

ретест свинга с откатом не глубже 50% импульса и новым уходом по тренду в пределах L баров.
→ Ставим якорь на time/price pivot-бар.

2)Слом структуры против текущего якоря:

цена закрепилась по другую сторону AVWAP: K подряд закрытий (для 1H: K=3, для 4H: K=2) по другую сторону AVWAP и средняя дистанция закрытий от линии ≥ 0.25×mTR(TF).
→ Это признак, что текущий AVWAP “перевернулся” в роль сопротивления/поддержки — ищем новый свинг и переякориваем по правилу (1) при первом валидном импульсе.

3)Старение якоря (TTL):

якорю > N баров (для 1H: N=60 ≈ 2.5 суток, для 4H: N=30 ≈ 5 суток) и за это время образовался любой новый свинг с импульсом ≥ 1.0×mTR(TF).
→ Разрешить “мягкое” переякоривание на более свежий свинг.

Чего не делаем:

Не двигаем якорь на каждый микросвинг.

Не меняем якорь внутри затяжного флэта (ADX/BBw/ATR-фильтр можно включить: если mTR(TF) сильно падает, запрещать переякоривание — параметризуемо).
4) Гистерезис (чтобы не дёргалось)

После установки якоря ввести лок на lock_bars (напр., 1H: lock_bars=8, 4H: lock_bars=4), в течение которых переякоривание запрещено, кроме события “слом структуры” (условие 2).

Порог импульса/подтверждения можно держать чуть выше сразу после переякоривания (например, impulse >= 1.7×mTR первые lock_bars), чтобы не перескочить назад.

5) Как использовать два якоря одновременно


Символы для анализа:
Все символы из общего списка

Новая таблица action_price_signals

Конфликты с основными стратегиями:
Разрешить параллельно (разные системы)?

общее правило 1 сигнал на 1 монету не относиться к стратегии Price Action, но правило 1 символ 1 монета, внутри стратегии действует.

Config.yaml:
Добавить секцию для Action Price
Primary AVWAP (по правилам выше) + Secondary AVWAP (старший ТФ).



Конфлюэнс: считаем сигнал сильнее, если цена внутри tol = 0.5×mTR(1H) от любого из них вместе с твоей зоной S/R.

Если оба в разных местах, приоритет у Primary; Secondary — как бонус к “confidence”.